// Generated by CoffeeScript 1.3.2
var shr,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

shr = {};

shr.JSONP = function(location) {
  var script;
  script = document.createElement('script');
  script.src = location;
  return document.querySelector('head').appendChild(script);
};

shr.Share = (function() {

  function Share(container, options) {
    var stylesheet,
      _this = this;
    this.container = container;
    this.options = options;
    this.options = this.options || {};
    this.options.location = this.options.location || window.location.href;
    this.options.title = this.options.title || document.title;
    this.options.services = this.options.services || ['twitter', 'facebook', 'linkedin'];
    this.options.theme = this.options.theme || 'default';
    shr.services = [];
    this.options.services.forEach(function(service) {
      try {
        return shr.services[service] = new shr[service.charAt(0).toUpperCase() + service.slice(1)](_this.container, _this.options.location, _this.options.title);
      } catch (e) {
        return console.error('"' + service + '" service doesn\'t exist.');
      }
    });
    stylesheet = document.createElement('link');
    stylesheet.rel = 'stylesheet';
    stylesheet.href = 'themes/' + this.options.theme + '.css';
    document.querySelector('head').appendChild(stylesheet);
  }

  return Share;

})();

shr.Service = (function() {

  function Service() {}

  Service.prototype.render = function() {
    shr.JSONP(this.endpoints.count);
    return document.querySelector(this.container).innerHTML += '<div class="shr_share ' + this["class"] + '"><a href="' + this.endpoints.share + '" class="label" onclick="window.open(this.href);return false;">' + this.label + '</a><span class="count">...</span></div>';
  };

  return Service;

})();

shr.Facebook = (function(_super) {

  __extends(Facebook, _super);

  function Facebook(container, location, title) {
    this.container = container;
    this.location = location;
    this.title = title;
    this.label = 'Facebook';
    this["class"] = 'facebook';
    this.endpoints = {
      share: 'http://www.facebook.com/sharer.php?t=' + this.title + '&u=' + this.location,
      count: 'http://graph.facebook.com/' + this.location + '?callback=shr.services.facebook.callback'
    };
    this.render();
  }

  Facebook.prototype.callback = function(res) {
    res.shares = res.shares || 0;
    return document.querySelector(this.container + ' .' + this["class"] + ' .count').innerHTML = res.shares;
  };

  return Facebook;

})(shr.Service);

shr.Linkedin = (function(_super) {

  __extends(Linkedin, _super);

  function Linkedin(container, location, title) {
    this.container = container;
    this.location = location;
    this.title = title;
    this.label = 'Linkedin';
    this["class"] = 'linkedin';
    this.endpoints = {
      share: ' http://linkedin.com/shareArticle?url=' + this.location + '&title=' + this.title,
      count: 'http://linkedin.com/countserv/count/share?url=' + this.location + '&callback=shr.services.linkedin.callback'
    };
    this.render();
  }

  Linkedin.prototype.callback = function(res) {
    return document.querySelector(this.container + ' .' + this["class"] + ' .count').innerHTML = res.count;
  };

  return Linkedin;

})(shr.Service);

shr.Twitter = (function(_super) {

  __extends(Twitter, _super);

  function Twitter(container, location, title) {
    this.container = container;
    this.location = location;
    this.title = title;
    this.label = 'Twitter';
    this["class"] = 'twitter';
    this.endpoints = {
      share: 'https://twitter.com/intent/tweet?text=' + this.title + '&url=' + this.location,
      count: 'http://urls.api.twitter.com/1/urls/count.json?url=' + this.location + '&callback=shr.services.twitter.callback'
    };
    this.render();
  }

  Twitter.prototype.callback = function(res) {
    return document.querySelector(this.container + ' .' + this["class"] + ' .count').innerHTML = res.count;
  };

  return Twitter;

})(shr.Service);
